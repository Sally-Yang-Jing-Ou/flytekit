FROM python:3.10-slim-bookworm as agent-slim

MAINTAINER Flyte Team <users@flyte.org>
LABEL org.opencontainers.image.source=https://github.com/flyteorg/flytekit

RUN apt-get update && apt-get install build-essential -y

COPY ./plugins/flytekit-timesensor /root/timesensor
RUN pip install /root/timesensor

RUN pip install prometheus-client grpcio-health-checking
RUN pip install --no-cache-dir -U flytekit \
  flytekitplugins-airflow \
  flytekitplugins-bigquery \
  flytekitplugins-openai \
  flytekitplugins-snowflake \
  flytekitplugins-awssagemaker \
  && apt-get clean autoclean \
  && apt-get autoremove --yes \
  && rm -rf /var/lib/{apt,dpkg,cache,log}/ \
  && :

CMD pyflyte serve agent --port 8000